package tcs.lbs.intentsniffer;

import androidx.appcompat.app.AppCompatActivity;

import android.content.BroadcastReceiver;
import android.content.Context;
import android.content.Intent;
import android.content.IntentFilter;
import android.location.Location;
import android.net.Uri;
import android.os.Bundle;
import android.widget.TextView;

public class MainActivity extends AppCompatActivity
{
    TextView LatitudeTextView, LongitudeTextView;

    IntentBroadcastReceiver mReceiver;
    IntentBroadcastReceiverIntra mReceiverIntra;
    static final String RECEIVER_ACTION = "tcs.lbs.weather_app.WeatherBroadcastReceiver";
    static final String RECEIVER_ACTION_INTRA_APP = "tcs.lbs.locationapp.MainActivityReceiver";

    @Override
    protected void onCreate(Bundle savedInstanceState)
    {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        LatitudeTextView = findViewById(R.id.LatitudeTextView);
        LongitudeTextView = findViewById(R.id.LongitudeTextView);

        // Inter-app communication intent sniffing (with weatherapp)
		/*
        IntentFilter filter = new IntentFilter();
        filter.addAction(RECEIVER_ACTION);
        mReceiver = new IntentBroadcastReceiver();
    	registerReceiver(mReceiver, filter);
		*/

        // Intra-app communication intent sniffing (inside of locationapp)
        IntentFilter filterIntra = new IntentFilter();
        filterIntra.addAction(RECEIVER_ACTION_INTRA_APP);
        mReceiverIntra = new IntentBroadcastReceiverIntra();
        registerReceiver(mReceiverIntra, filterIntra);
    }

    public class IntentBroadcastReceiverIntra extends BroadcastReceiver {
        @Override
        public void onReceive(Context context, Intent intent) {
            Location location = intent.getParcelableExtra("Location");
            if (location != null) {
                LatitudeTextView.setText(Double.toString(location.getLatitude()));
                LongitudeTextView.setText(Double.toString(location.getLongitude()));
            }
        }
    }

    public class IntentBroadcastReceiver extends BroadcastReceiver {

        @Override
        public void onReceive(Context context, Intent intent) {
            Location location = intent.getParcelableExtra("Location");
            if (location != null) {
                LatitudeTextView.setText(Double.toString(location.getLatitude()));
                LongitudeTextView.setText(Double.toString(location.getLongitude()));
            }
        }
    }
}
