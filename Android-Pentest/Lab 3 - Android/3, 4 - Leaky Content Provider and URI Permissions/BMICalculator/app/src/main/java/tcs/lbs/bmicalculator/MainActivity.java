package tcs.lbs.bmicalculator;

import androidx.appcompat.app.AppCompatActivity;

import android.annotation.SuppressLint;
import android.content.ContentValues;
import android.database.Cursor;
import android.net.Uri;
import android.os.Bundle;
import android.view.View;
import android.widget.EditText;
import android.widget.TextView;

public class MainActivity extends AppCompatActivity
{
    EditText heightEditText, weightEditText;
    TextView resultTextView;
    @Override
    protected void onCreate(Bundle savedInstanceState)
    {
        super.onCreate(savedInstanceState);
        setContentView(R.layout.activity_main);

        heightEditText = findViewById(R.id.editTextHeight);
        weightEditText = findViewById(R.id.editTextWeight);
        resultTextView = findViewById(R.id.textViewResult);
    }

    public void btn_calculate_onClick(View v)
    {
        try
        {
            int height = Integer.parseInt(heightEditText.getText().toString());
            float weight = Float.parseFloat(weightEditText.getText().toString());
            float bmi = (100*100*weight)/(height*height);
            resultTextView.setText("You Are " + bmiResult(bmi) + "!");

            ContentValues values = new ContentValues();
            values.put(DataBaseProvider.height, heightEditText.getText().toString());
            values.put(DataBaseProvider.weight, weightEditText.getText().toString());
            values.put(DataBaseProvider.bmi, bmiResult(bmi));
            getContentResolver().insert(DataBaseProvider.CONTENT_URI, values);
        }
        catch (Exception e)
        {
            resultTextView.setText("An Error Occurred!!");
        }
    }

    @SuppressLint("Range")
    public void btn_history_onClick(View v)
    {
        // Retrieve bmi records
        Cursor cursor = getContentResolver().query(Uri.parse("content://tcs.lbs.bmicalculator/database"), null, null, null, null);
        if(cursor.moveToFirst()) {
            StringBuilder strBuild = new StringBuilder();
            while (!cursor.isAfterLast())
            {
                strBuild.append("\n"+
                        cursor.getString(cursor.getColumnIndex("height")) + " - " +
                        cursor.getString(cursor.getColumnIndex("weight")) + " - " +
                        cursor.getString(cursor.getColumnIndex("bmi")));
                cursor.moveToNext();
            }
            resultTextView.setText(strBuild);
        }
        else
        {
            resultTextView.setText("No Records Found");
        }
    }

    private String bmiResult(float bmi)
    {
        if(bmi < 18.5)
        {
            return("Underweight");
        }
        else if (bmi < 25)
        {
            return("Normal");
        }
        else if (bmi < 30)
        {
            return("Overweight");
        }
        else
        {
            return("Obese");
        }
    }
}